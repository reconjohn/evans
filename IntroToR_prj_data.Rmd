<br> 
<center><img src="http://i.imgur.com/sSaOozN.png" width="500"></center>


## Course:  COMPUTATIONAL THINKING FOR GOVERNANCE ANALYTICS

#### Yohan Min

_____
<a id='part1'></a>

# Session 5: Intro to R (I)

Collect the data we prepared in Python:

```{r collecting}
link='https://github.com/reconjohn/evan_data/raw/master/data.RDS'
# a RDS file from the web needs:
myFile=url(link)

# reading in data:
fromPy=readRDS(file = myFile)

# reset indexes to R format:
row.names(fromPy)=NULL
```



# <font color="red">Data frames in R</font>

Data frames are a native structure for R. You can now the data types you have using **str()**:

```{r using_str}
str(fromPy)#,width = 70,strict.width='cut')
fromPy=fromPy[complete.cases(fromPy),] # delete all the missing values
```

If you need to know only the variable names, you just need **names()**
```{r using_names}
names(fromPy)
```

You can visit any value knowing the indexes:
* a cell:
```{r check_cell}
fromPy[2,3]
```
* a row:
```{r check_row}
fromPy[2,]
```

* a column:
```{r check_column}
head(fromPy[,3])
```

* a row and some columns using **c()** to prepare a vector of indexes:
```{r check_rowcolPOS}
# by position:
fromPy[2,c(2,3)]
```

```{r check_rowcolVAL}
# by value:
fromPy[20,c('Entity','Year','SolarCapacityGW')]
```

You can create and replace any value you recover (cel, row, column) with **=** or **<-**:

Example 1:
```{r createCol}
# create new column:
fromPy$ZERO=0
# then:
head(fromPy)
```

Example 2:
```{r replaceCol}
# replace column values:
fromPy$ZERO=1
# then:
head(fromPy)
```

Example 3:
```{r deleteCol}
# DELETE column:
fromPy$ZERO=NULL
# then:
names(fromPy)
```

## Querying data frames:

* What is the Entity with highest HDI?
```{r query1}
# you could get more than one
condition1=fromPy$SolarCapacityGW==max(fromPy$SolarCapacityGW)
fromPy[condition1,]
```

```{r query2}
#or
fromPy[condition1,'Entity']
```

You also have:
```{r query3}
# in multiple max, you get only the first one.
fromPy[which.max(fromPy$SolarCapacityGW),'Entity']
```

* What is the Entity with highest HDI in America?

```{r query4}
# from AMERICA:
N_AMERICA=c('Canada','United States')
condition2=fromPy$Entity %in% N_AMERICA
subN_America=fromPy[condition2,]

condition1=subN_America$SolarCapacityGW==max(subN_America$SolarCapacityGW)
subN_America[condition1,'Entity']
```

A version using **pipes** and **dplyr**:

```{r query5_pipes}
library(magrittr)
library(dplyr)

fromPy%>%
    filter(Entity %in% N_AMERICA)%>%
    filter(SolarCapacityGW==max(SolarCapacityGW))%>%
    select(Entity)
```

* What is the Entity with highest HDI not from America?

```{r query6}
subNotAmerica=fromPy[!condition2,]

subNotAmerica[condition1,'Entity']
```

A version using **pipes** and **dplyr**:

```{r query7_pipes}
fromPy%>%
    filter(!Entity %in% N_AMERICA)%>%
    filter(SolarCapacityGW==max(SolarCapacityGW))%>%
    select(Entity)
```


## Aggregating/summarizing data frames:

* The average HDI per Entity:

```{r aggre1}
# the result is a data frame:
aggregate(data=fromPy,SolarCapacityGW ~ Entity,FUN=mean)
```

A version using **pipes** and **dplyr**:

```{r aggre2_pipes}
fromPy%>%
    group_by(Entity) %>% 
    summarise(mean(SolarCapacityGW))
```

You can make more complex aggregations that way:
```{r aggre3_pipes}
fromPy%>%
    group_by(Entity) %>% 
    summarise(meanGW=mean(SolarCapacityGW),
              medianGW=median(SolarCapacityGW))

```
```{r}
aggregate(data=fromPy,SolarCapacityGW ~ Entity,FUN=function(x) cbind(mean(x), median(x)))
```


* The median of the democracy components:

```{r aggre4}
# several columns in cbind...
aggregate(data=fromPy,
          cbind(Year, SolarCapacityGW)~Entity,
          FUN=median)

```

If you know the indexes of the columns:

```{r aggre5}
# In ".~ Entity" the dot represents all the other variables
aggregate(data=fromPy[,c(1:3)],.~Entity,FUN=median)
```

A version using **pipes** and **dplyr**:

```{r aggre6_pipes}
fromPy[,c(1:3)]%>%
    group_by(Entity) %>% 
    summarise_all(list(median)) 
```

A more complex version:

```{r aggre7_pipes}
fromPy[,c(1:3)]%>%
    group_by(Entity) %>% 
    summarise_all(list(MIN=min,MAX=max)) 
```

## Creating new data:

One column:

```{r createColifelse}
# AboveGW is the new variable:
# 1 if the value is < median, ) otherwise.
fromPy$AboveGW=ifelse(fromPy$SolarCapacityGW>
                          median(fromPy$SolarCapacityGW),
                      1,0)
# then:
head(fromPy)
```

A version using **pipes** and **dplyr**:

```{r createColifelse_pipes}
# you will add a new column at the end (this is a preview):
fromPy%>%
    mutate(AboveGW =ifelse(SolarCapacityGW >
                           median(SolarCapacityGW),
                           1, 0))%>%head()
```





